<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="egovframework.example.beacon.mapper.BeaconMapper">

	<select id="beaconSelect" resultType="egovframework.example.beacon.vo.BeaconVO">
		SELECT * FROM beacon_info
		order by reg_date desc
	</select>

	<select id="beaconInfoList" resultType="egovframework.example.beacon.vo.BeaconVO">
		SELECT a.*, b.site_name 
		FROM (
			SELECT * FROM beacon_info 
			WHERE UUID= #{uuid}
		) AS a
		LEFT JOIN site_info b ON a.site_id = b.site_id
	</select>
	
	
	<!-- 비콘 삭제하기 -->
	<delete id="deleteBeaconInfo">
		delete from beacon_info
		where uuid = #{uuid}
	</delete>
	
	
	<!-- 적용 현장 선택 리스트 가져오기 -->
	<select id="selectSite" resultType="egovframework.example.view.vo.ViewVO">
		select site_name, site_id
		from site_info
		order by reg_date desc
	</select>
	
	
	<!-- 비콘 등록하기 -->
	<insert id="insertBeacon" parameterType="egovframework.example.beacon.vo.BeaconVO">
		insert into beacon_info (UUID,MAJOR,MINOR,LIMIT_FLAG,DANGER_DISTANCE,BEACON_Y,BEACON_X,SITE_ID,BEACON_NAME,REG_DATE)
		values (#{UUID},#{MAJOR},#{MINOR},#{LIMIT_FLAG},#{DANGER_DISTANCE},#{BEACON_Y},#{BEACON_X},#{SITE_ID},#{BEACON_NAME},NOW())
	</insert>
	
	<!-- 비콘 정보 수정하기 -->
	<update id="updateBeacon" parameterType="egovframework.example.beacon.vo.BeaconVO">
		update beacon_info set
		MAJOR = #{MAJOR},
		MINOR = #{MINOR},
		LIMIT_FLAG = #{LIMIT_FLAG},
		DANGER_DISTANCE = #{DANGER_DISTANCE},
		BEACON_Y = #{BEACON_Y},
		BEACON_X = #{BEACON_X},
		SITE_ID = #{SITE_ID},
		BEACON_NAME = #{BEACON_NAME}
		where uuid = #{UUID}
	</update>

</mapper>